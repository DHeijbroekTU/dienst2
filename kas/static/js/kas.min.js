(function(){var addItem;window.App=angular.module("kas",["kas.controllers","typeahead"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/transactions",{templateUrl:window.prefix+"partials/kas/transactions.html",controller:"TransactionController"}),$routeProvider.when("/closures",{templateUrl:window.prefix+"partials/kas/closures.html",controller:"ClosureController"}),$routeProvider.when("/closures/:closureID",{templateUrl:window.prefix+"partials/kas/closure.html",controller:"ClosureDetailController"}),$routeProvider.otherwise({redirectTo:"/transactions"})}]),addItem={},angular.module("kas.controllers",["kas.apiv2"]).controller("TransactionController",["$scope","Transaction",function($scope,Transaction){return $scope.transactions=[],Transaction.all(function(transactions){return $scope.transactions=transactions}),addItem=function(transaction){return $scope.transactions.push(transaction)},$scope.next=function(){return $scope.transactions.next(function(transactions){return $scope.transactions=transactions})},$scope.previous=function(){return $scope.transactions.previous(function(transactions){return $scope.transactions=transactions})}}]).controller("TransactionFormController",["$scope","Transaction",function($scope,Transaction){return angular.element("input[ng-model='amount']").focus(),$scope.inout="OUT",$scope.toggleInout=function(){return $scope.inout="OUT"===$scope.inout?"IN":"OUT","OUT"===$scope.inout?$scope.method="CASH":void 0},$scope.method="CASH",$scope.toggleMethod=function(){return $scope.method="CASH"===$scope.method?"PIN":"CASH","PIN"===$scope.method?$scope.inout="IN":void 0},$scope.submit=function(){var transaction;return $scope.amount&&$scope.description?(transaction=new Transaction,transaction.amount=Math.abs(parseFloat($scope.amount.replace(",","."))),"OUT"===$scope.inout&&(transaction.amount*=-1),transaction.method="CASH"===$scope.method?"C":"P",transaction.description=$scope.description,transaction.valid=!0,transaction.create(function(obj){return $scope.inout="OUT",$scope.method="CASH",$scope.amount="",$scope.description="",addItem(obj),angular.element("input[ng-model='amount']").focus()})):void 0}}]).controller("ClosureController",["$scope","Transaction","Closure",function($scope,Transaction,Closure){return $scope.unfinished=!1,Closure.unfinished(function(closure){return 1===closure.total_count?$scope.unfinished=closure[0]:void 0}),$scope.closures=[],Closure.all(function(closures){return $scope.closures=closures}),$(".extrainfo").popover({trigger:"focus",placement:"bottom",title:"Informatie"})}]).controller("ClosureFormController",["$scope","$location","Transaction","Closure",function($scope,$location,Transaction,Closure){return $scope.newclosure=function(){var closure,transaction_cash,transaction_pin;return $scope.in_cash&&(transaction_cash=new Transaction,transaction_cash.amount=parseFloat($scope.in_cash.replace(",",".")),transaction_cash.method="C",transaction_cash.description="Kasinkomsten",transaction_cash.valid=!0,transaction_cash.create(function(){})),$scope.in_pin&&(transaction_pin=new Transaction,transaction_pin.amount=parseFloat($scope.in_pin.replace(",",".")),transaction_pin.method="P",transaction_pin.description="Pininkomsten",transaction_pin.valid=!0,transaction_pin.create(function(){})),closure=new Closure,closure.create(function(obj){return $location.path("/closures/"+obj.id)})}}]).controller("ClosureDetailController",["$routeParams","$scope","Transaction","Closure",function($routeParams,$scope,Transaction,Closure){return $scope.closure=!1,$scope.transactions=[],Closure.get($routeParams.closureID,function(closure){return $scope.closure=closure,$scope.closure.finished||$scope.closure.update(function(closure){return $scope.closure=closure}),$scope.loadTransactions()}),$scope.loadTransactions=function(){return Transaction.inClosure($scope.closure,function(transactions){return $scope.transactions=transactions})},$scope.save=function(){return $scope.closure.update(function(closure){return $scope.loadTransactions(),$scope.closure=closure,0===$scope.closure.cashdifference&&0===$scope.closure.pindifference||$scope.confirmed?($scope.closure.finished=!0,$scope.closure.update(function(){return $scope.confirmed=$scope.problem=!1,alert("Dagafsluiting voltooid.")})):$scope.problem=!0})},$scope.confirm=function(){return $scope.confirmed=!0,$scope.save()},$scope.$watch("closure.num_e500 + closure.num_e200 + closure.num_e100 + closure.num_e50 + closure.num_e20 + closure.num_e10 + closure.num_e5 + closure.num_e2 + closure.num_e1 + closure.num_e050 + closure.num_e020 + closure.num_e010 + closure.num_e005",function(){return $scope.closure.total=500*$scope.closure.num_e500+200*$scope.closure.num_e200+100*$scope.closure.num_e100+50*$scope.closure.num_e50+20*$scope.closure.num_e20+10*$scope.closure.num_e10+5*$scope.closure.num_e5+2*$scope.closure.num_e2+1*$scope.closure.num_e1+.5*$scope.closure.num_e050+.2*$scope.closure.num_e020+.1*$scope.closure.num_e010+.05*$scope.closure.num_e005}),$(document).delegate("input.input-mini","keyup",function(){return $scope.$digest()})}]),angular.module("kas.apiv2",["dienst2"]).factory("Transaction",["Tastypie",function(Tastypie){var Transaction;return Transaction=Tastypie("api/v2/transaction/"),Transaction.prototype.toString=function(){return this.description},Transaction.prototype.toggleValid=function(){return this.editable?(this.valid=this.valid?!1:!0,this.update()):void 0},Transaction.inClosure=function(closure,success){var params;return params={limit:0,date__lte:closure.date},closure.previousdate&&(params.date__gt=closure.previousdate),Transaction._more({method:"GET",url:Transaction.api_root,params:params},success)},Transaction}]).factory("Closure",["Tastypie",function(Tastypie){var Closure;return Closure=Tastypie("api/v2/closure/"),Closure.prototype.toString=function(){return this.date},Closure.unfinished=function(success){return Closure._more({method:"GET",url:Closure.api_root,params:{finished:!1}},success)},Closure}])}).call(this);
(function(){var emptyAddr;window.App=angular.module("ldb",["ldb.controllers","typeahead","dienst2.forms"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/dashboard",{templateUrl:window.prefix+"partials/ldb/dashboard.html",controller:"DashboardController"}),$routeProvider.when("/person/new",{templateUrl:window.prefix+"partials/ldb/person.html",controller:"PersonDetailController"}),$routeProvider.when("/person/:personID",{templateUrl:window.prefix+"partials/ldb/person.html",controller:"PersonDetailController"}),$routeProvider.when("/organization/new",{templateUrl:window.prefix+"partials/ldb/organization.html",controller:"OrganizationDetailController"}),$routeProvider.when("/organization/:organizationID",{templateUrl:window.prefix+"partials/ldb/organization.html",controller:"OrganizationDetailController"}),$routeProvider.when("/export",{templateUrl:window.prefix+"partials/ldb/export.html",controller:"ExportController"}),$routeProvider.otherwise({redirectTo:"/dashboard"})}]),angular.module("ldb.controllers",["ldb.apiv2"]).controller("DashboardController",["$scope","Person","Organization",function($scope,Person,Organization){var classes,searchID;return $scope.search="",$scope.searchtype="p",$scope.results=[],classes={o:Organization,p:Person},searchID=0,$scope.$watch("searchtype + search",function(){return $scope.search.length>1?(searchID++,classes[$scope.searchtype].search($scope.search,function(results,status,headers,config){return config.params.searchID===searchID?$scope.results=results:void 0},"start",searchID)):$scope.results=[]}),$("#zoekbalk").focus()}]).controller("PersonDetailController",["$routeParams","$location","$scope","Person","Committee","CommitteeMembership","country_list",function($routeParams,$location,$scope,Person,Committee,CommitteeMembership,country_list){return $scope.country_list=country_list,$scope.editmode="on"===$routeParams.editmode,$scope.admin=window.admin,$scope.$watch("editmode",function(){return $scope.editmode?$location.search("editmode","on"):$routeParams.editmode?$location.search("editmode","off"):void 0}),$scope.committeelist=[],Committee.all(function(committeelist){return $scope.committeelist=committeelist}),$scope.committeeFilter=function(committee){return!committee._delete},$scope.otherpersons=function(query,callback){return Person.search(query,function(sources){return callback(sources)},"start")},$scope.notLivingWith=function(){return $scope.living_with_model=null,$scope.living_with=null,$scope.person.living_with_model=null,$scope.person.living_with=null},$scope.$watch("living_with_model",function(){var model;return model=$scope.living_with_model,model&&model.resource_uri?($scope.person.living_with_model=model,$scope.person.living_with=model.resource_uri):void 0}),$scope.save=function(){return $scope.person.saveAll(function(){return $location.path("/person/"+$scope.person.id)}),$scope.editmode=!1},$scope.removePerson=function(){return $scope.person.remove(function(){return alert("Removed person."),$location.path("/dashboard")})},$routeParams.personID?Person.get($routeParams.personID,function(person){return $scope.person=person,$scope.person.loadSubresources()}):($scope.person=new Person,$scope.person.loadSubresources(),$scope.editmode=!0)}]).controller("OrganizationDetailController",["$routeParams","$location","$scope","Organization","country_list",function($routeParams,$location,$scope,Organization,country_list){return $scope.country_list=country_list,$scope.editmode="on"===$routeParams.editmode,$scope.admin=window.admin,$scope.$watch("editmode",function(){return $scope.editmode?$location.search("editmode","on"):$routeParams.editmode?$location.search("editmode","off"):void 0}),$scope.save=function(){return $scope.organization.save(function(){return $location.path("/organization/"+$scope.organization.id)}),$scope.editmode=!1},$scope.removeOrganization=function(){return $scope.organization.remove(function(){return alert("Removed organization"),$location.path("/dashboard")})},$routeParams.organizationID?Organization.get($routeParams.organizationID,function(organization){return $scope.organization=organization}):($scope.organization=new Organization,$scope.editmode=!0)}]).controller("ExportController",["$scope",function(){}]),emptyAddr=function(){return this.street_name=this.house_number=this.address_2=this.address_3=this.postcode=this.city=this.country=""},angular.module("ldb.apiv2",["dienst2"]).factory("Member",["Tastypie",function(Tastypie){var Member;return Member=Tastypie("api/v2/member/")}]).factory("Student",["Tastypie","$filter",function(Tastypie,$filter){var Student;return Student=Tastypie("api/v2/student/"),Student.prototype.confirm=function(){var datefilter,today;return today=new Date,datefilter=$filter("date"),this.date_verified=datefilter(today,"yyyy-MM-dd"),this.resource_uri?this.update():void 0},Student}]).factory("Alumnus",["Tastypie",function(Tastypie){var Alumnus;return Alumnus=Tastypie("api/v2/alumnus/")}]).factory("Employee",["Tastypie",function(Tastypie){var Employee;return Employee=Tastypie("api/v2/employee/")}]).factory("CommitteeMembership",["Tastypie",function(Tastypie){var CommitteeMembership;return CommitteeMembership=Tastypie("api/v2/committeeMembership/")}]).factory("Person",["Tastypie","Member","Student","Alumnus","Employee","CommitteeMembership",function(Tastypie,Member,Student,Alumnus,Employee,CommitteeMembership){var Person,process;return Person=Tastypie("api/v2/person/"),Person.prototype.emptyAddr=emptyAddr,Person.prototype.toString=function(){var name;return name=this.firstname,this.preposition&&(name+=" "+this.preposition),name+=" "+this.surname},Person.prototype.committeememberships=[],Person.prototype.loadSubresources=function(success){var self,update;return update=function(){return success?success():void 0},self=this,Student.getSubresource(self.student,function(student){return student||(student=new Student),self.student_model=student,update()}),Member.getSubresource(self.member,function(member){return member||(member=new Member),self.member_model=member,update()}),Alumnus.getSubresource(self.alumnus,function(alumnus){return alumnus||(alumnus=new Alumnus),self.alumnus_model=alumnus,update()}),Employee.getSubresource(self.employee,function(employee){return employee||(employee=new Employee),self.employee_model=employee,update()}),Person.getSubresource(self.living_with,function(person){return self.living_with_model=person,update()}),self.committees?CommitteeMembership._more({method:"GET",url:CommitteeMembership.api_root,params:{limit:0,person:self.id}},function(committeememberships){return self.committeememberships=committeememberships,update()}):void 0},process=function(obj,success,handleError){if(obj._delete){if(obj.resource_uri)return obj.remove(success,handleError)}else if(obj.changed())return obj.resource_uri?obj.update(success,handleError):obj.create(success,handleError)},Person.prototype.newCommittee=function(){var committeemembership;return committeemembership=new CommitteeMembership,committeemembership.person=this.resource_uri,this.committeememberships.push(committeemembership)},Person.prototype.saveAll=function(success,error){var handleError;return handleError=error,this.living_with_model&&(this.living_with=this.living_with_model.resource_uri),this.student_model.save(void 0,alert),this.member_model.save(void 0,alert),this.alumnus_model.save(void 0,alert),this.employee_model.save(void 0,alert),angular.forEach(this.committeememberships,function(obj){return obj.save(void 0,alert)}),this.save(success,alert)},Person}]).factory("Organization",["Tastypie",function(Tastypie){var Organization;return Organization=Tastypie("api/v2/organization/"),Organization.prototype.emptyAddr=emptyAddr,Organization}]).factory("Committee",["Tastypie",function(Tastypie){var Committee;return Committee=Tastypie("api/v2/committee/"),Committee.prototype.toString=function(){return this.committeename},Committee.all=function(success){return Committee._more({method:"GET",url:Committee.api_root,params:{limit:0},cache:!0},success)},Committee}])}).call(this);